<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Builder</title>
</head>
<body>
    <p><a href="https://learn.liferay.com/w/dxp/headless-delivery/api-builder">API builder</a> é atualmente uma beta feature pela qual administradores podem customizar APIs de Objects, tanto System Objects quanto novos Objects.</p>

    <p>O escopo do que pode ser customizado, neste momento, ainda é pequeno.</p>

    <h3>Atualmente o API Builder permite customizar em um endpoint, dentro deste escopo:</h3>
    <ul>
        <li>Omitir campos do response body original</li>
        <li>Alterar o nome de campos do response body original</li>
        <li>Aplicar filtros no endpoint original</li>
        <li>Aplicar ordenação no endpoint original</li>
        <li>Expor o novo endpoint customizado pelo método GET ou POST</li>
    </ul>

    <h3>Não está no escopo atual do API Builder</h3>
    <ul>
        <li>Transformar dados do endpoint original, ex: operações em texto, aritmética, lógica, etc</li>
        <li>Fazer outras chamadas HTTP que não seja o endpoint original</li>
    </ul>

    <h3>Feature Flag</h3>
    <p>Para começar, é necessário ativar a feature flag API Builder.</p>
    <p><code>Control Panel &gt; Instance Settings &gt; Feature Flags &gt; Beta &gt; API Builder (LPS-178642)</code></p>
    <img src="images/image-20240705-023701.png" alt="Feature Flag">

    <p>Após salvar e atualizar a página, ficará disponível no menu a nova opção API Builder</p>
    <img src="images/image-20240705-023851.png" alt="Menu API Builder">

    <h3>Criar um novo API</h3>
    <p>O primeiro passo é criar uma API onde poderão ser disponibilizados diversos endpoints, podendo estes endpoints customizar diferentes Objects.</p>
    <img src="images/image-20240705-024244.png" alt="Criar API">
    <img src="images/image-20240705-024831.png" alt="URL da API">

    <p>Neste caso a minha API será acessada pela URL /c/my-api. E os endpoints da minha API estão dentro dessa URL, como vamos ver a seguir.</p>
    <p>Na URL da API não aceitas novas barras, nem pontos, ou nenhum outro caractere especial além do traço.</p>
    <p>Não é possível atualmente criar uma URL para a API como por exemplo: /my-api/v1.0/</p>

    <h3>Criar um novo schema dentro do novo API</h3>
    <p>O próximo passo é criar um schema a ser usado por um ou mais endpoints da minha API</p>
    <img src="images/image-20240705-025127.png" alt="Criar Schema">

    <p>No meu caso vou criar um Schema baseado em um Object que criei e chamei de Article. Nesse object além dos campos default criei os campos AuthorName (text), Title (text), Stared (true or false)</p>
    <img src="images/image-20240705-025402.png" alt="Campos do Schema">

    <p>Como descrito no nome do meu custom schema estou criando um response simplificado omitindo todos os campos default e mostrando apenas os campos Title e AuthorName que criei no meu Object Article.</p>
    <p>Também estou mudando o nome AuthorName apenas para Author</p>
    <p>Esse campo Author não é o campo Author default do response original, é o campo AuthorName com o nome mudado para Author</p>
    <img src="images/image-20240705-025930.png" alt="Custom Schema">

    <h3>Criar um novo endpoint dentro do novo API</h3>
    <p>Finalmente podemos criar os endpoints que irão utilizar os schemas da API</p>
    <img src="images/image-20240705-030318.png" alt="Criar Endpoint">
    <img src="images/image-20240705-030336.png" alt="Endpoints Criados">

    <p>Nesse caso criei dois endpoints customizados</p>
    <p><code>/articles</code> irá listar todos os meus Articles mas com o response body simplificado omitindo a maioria dos campos</p>
    <p><code>/stared-articles</code> usar o mesmo schema que omite campos e adicionalmente aplicará um filtro implícito para retornar apenas articles com o campo stared igual à true.</p>

    <h3>Endpoint /articles</h3>
    <img src="images/image-20240705-030652.png" alt="Endpoint /articles">
    <img src="images/image-20240705-030702.png" alt="Exemplo de Response /articles">

    <h3>Endpoint /stared-articles</h3>
    <img src="images/image-20240705-030738.png" alt="Endpoint /stared-articles">
    <img src="images/image-20240705-030750.png" alt="Exemplo de Response /stared-articles">

    <h3>Testando a nova API</h3>
    <p>A nova API já está disponível para uso e também está disponível a sua documentação OpenAPI na página Liferay API Explorer da sua instância Liferay. Por exemplo, se estiver usando o liferay em localhost:8080 pode encontrar a Liferay API Explorer ao acessar: <a href="http://localhost:8080/o/api">http://localhost:8080/o/api</a></p>
    <p>No menu REST Applications, encontre a sua API criada pelo API Builder, no nosso caso a que tem a URL <code>/c/my-api</code></p>
    <p>O prefixo <code>/c</code> na URL da API customizada não é opcional e nem editável</p>
    <img src="images/image-20240705-031450.png" alt="Liferay API Explorer">

    <h3>Testando o endpoint /articles</h3>
    <img src="images/image-20240705-031644.png" alt="Testando /articles">
    <p>Ao executar esse endpoint o retorno será todos os articles somente com os campos configurados no schema customizado. Por exemplo</p>

    <pre><code>{
      "actions": {},
      "facets": [],
      "items": [
        {
          "Author": "M. Tanuri",
          "Title": "Hello World"
        },
        {
          "Author": "M. Tanuri",
          "Title": "Trying API Builder!"
        }
      ],
      "lastPage": 1,
      "page": 1,
      "pageSize": 20,
      "totalCount": 2
    }
    </code></pre>

    <h3>Testando o endpoint /stared-articles</h3>
    <img src="images/image-20240705-031956.png" alt="Testando /stared-articles">
    <p>Ao executar esse endpoint o retorno será apenas os articles com o valor do campo stared igual à true e somente com os campos configurados no schema customizado serão apresentados. Por exemplo:</p>

    <pre><code>{
      "actions": {},
      "facets": [],
      "items": [
        {
          "Author": "M. Tanuri",
          "Title": "Trying API Builder!"
        }
      ],
      "lastPage": 1,
      "page": 1,
      "pageSize": 20,
      "totalCount": 1
    }
    </code></pre>

    <p>Neste momento nossa aplicação está pronta para ser utilizada, entretanto somente usuários autenticados no Liferay terão permissão de acessá-la. No próximo blog revelaremos mais detalhes dessa beta feature, e como configurar acesso público a seus endpoints.</p>
</body>
</html>